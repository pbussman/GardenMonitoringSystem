from veml7700 import VEML7700
import machine, time, json
from umqtt.simple import MQTTClient

i2c = machine.I2C(0, scl=machine.Pin(1), sda=machine.Pin(0))
sensor = VEML7700(i2c)

MQTT_BROKER = "your.mqtt.broker"
SENSOR_NAME = "bed1"
CLIENT_ID = "lux_" + SENSOR_NAME

def read_and_publish():
    lux = sensor.lux

    client = MQTTClient(CLIENT_ID, MQTT_BROKER)
    client.connect()

    client.publish(f"garden/sensor/{SENSOR_NAME}/light_intensity", json.dumps({
        "value": lux,
        "unit": "lux"
    }))

    client.disconnect()

while True:
    read_and_publish()
    time.sleep(300)
